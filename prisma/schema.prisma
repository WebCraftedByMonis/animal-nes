// This is your Prisma schema file
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model City {
  id        Int              @id @default(autoincrement())
  name      String           @unique
  charges   DeliveryCharge[]
  createdAt DateTime         @default(now())
}

model DeliveryCharge {
  id        Int      @id @default(autoincrement())
  amount    Float
  cityId    Int
  notes     String?  @db.Text
  city      City     @relation(fields: [cityId], references: [id], onDelete: Cascade)
  createdAt DateTime @default(now())

  @@index([cityId])
}

model Product {
  id             Int             @id @default(autoincrement())
  productName    String          @db.Text
  genericName    String?         @db.Text
  category       String?        @db.Text
  subCategory    String?         @db.Text
  subsubCategory String?       @db.Text
  productType    String?       @db.Text
  company        Company?         @relation(fields: [companyId], references: [id], onDelete: Cascade)
  companyId      Int
  partner        Partner?      @relation(fields: [partnerId], references: [id], onDelete: Cascade)
  partnerId      Int
  description    String?         @db.Text
  productLink    String?          @db.Text
  dosage         String?         @db.Text
  image          ProductImage?
  pdf            ProductPdf?
  outofstock     Boolean         @default(false)
  isFeatured     Boolean         @default(false)
  isActive       Boolean         @default(false)
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt
  variants       ProductVariant[]
  cartItems          CartItem[]
  checkoutItems      CheckoutItem[]
  wishlistItems      WishlistItem[]
  reviews            ProductReview[]
  discounts          Discount[]
  partnerCartItems   PartnerCartItem[]
  partnerOrderItems  PartnerOrderItem[]

  @@index([companyId])
  @@index([partnerId])
}

model ProductVariant {
  id             Int             @id @default(autoincrement())
  packingVolume  String   ?       @db.Text
  companyPrice   Float?
  dealerPrice    Float?
  customerPrice  Float?
  inventory      Int?
  product        Product         @relation(fields: [productId], references: [id], onDelete: Cascade)
  productId      Int
  cartItems          CartItem[]
  checkoutItems      CheckoutItem[]
  discounts          Discount[]
  partnerCartItems   PartnerCartItem[]
  partnerOrderItems  PartnerOrderItem[]

  @@index([productId])
}

model ProductPdf {
  id        Int      @id @default(autoincrement())
  url       String   @db.Text
  publicId  String?
  product   Product? @relation(fields: [productId], references: [id], onDelete: Cascade)
  productId Int?     @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([productId])
}

model ProductImage {
  id        Int      @id @default(autoincrement())
  url       String   @db.Text
  alt       String
  publicId  String?
  product   Product? @relation(fields: [productId], references: [id], onDelete: Cascade)
  productId Int      @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([productId])
}

model Company {
  id          Int              @id @default(autoincrement())
  companyName String?          @unique
  mobileNumber String?         @unique
  products    Product[]
  address     String?          @db.Text
  country     String?
  email       String?          @unique
  password    String?
  image       CompanyImage?
  stickyLogo  StickyLogo[]
  sessions        CompanySession[]
  discounts       Discount[]
  partnerOrders   PartnerOrder[]
  paymentSettings CompanyPaymentSettings?
  createdAt       DateTime?        @default(now())
  updatedAt       DateTime?        @updatedAt
}

model CompanyImage {
  id        Int      @id @default(autoincrement())
  url       String?   @db.Text
  alt       String?   @unique
  publicId  String?  @unique
  company   Company?  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  companyId Int?      @unique
  createdAt DateTime? @default(now())
  updatedAt DateTime? @updatedAt

  @@index([companyId])
}

enum Gender {
  MALE
  FEMALE
  OTHER
}

enum SendToPartner {
  YES
  NO
}

enum BloodGroup {
  A_POSITIVE
  B_POSITIVE
  A_NEGATIVE
  B_NEGATIVE
  AB_POSITIVE
  AB_NEGATIVE
  O_POSITIVE
  O_NEGATIVE
}

enum DayOfWeek {
  MONDAY
  TUESDAY
  WEDNESDAY
  THURSDAY
  FRIDAY
  SATURDAY
  SUNDAY
}

model PartnerImage {
  id        Int      @id @default(autoincrement())
  url       String?   @db.Text
  alt       String?
  publicId  String?
  partner   Partner? @relation(fields: [partnerId], references: [id], onDelete: Cascade)
  partnerId Int?     @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([partnerId])
}

model StartTime {
  id        Int      @id @default(autoincrement())
  name      String
  startTime DateTime @db.Time
  endTime   DateTime @db.Time
  partners  Partner[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Partner {
  id                  Int                   @id @default(autoincrement())
  partnerName         String                @db.Text
  gender              Gender?
  partnerEmail        String?               @unique
  shopName            String?               @db.Text
  partnerMobileNumber String?
  cityName            String?
  country             String?
  fullAddress         String?               @db.Text
  rvmpNumber          String?
  sendToPartner       SendToPartner?
  qualificationDegree String?
  zipcode             String?
  state               String?
  areaTown            String?               @db.Text
  password            String?
  bloodGroup          BloodGroup?
  availableDaysOfWeek PartnerAvailableDay[]
  partnerImage        PartnerImage?
  startTime           StartTime[]
  specialization      String?               @db.Text
  species             String?
  partnerType         String?
  numberOfAnimals     Int?
  animalEntries       Json?                 // Array of {animalType: string, count: number}
  isPremium           Boolean               @default(false)
  referralCode        String?               @unique
  walletBalance       Float                 @default(0)
  referredById        Int?
  referredBy          Partner?              @relation("PartnerReferrals", fields: [referredById], references: [id])
  referrals           Partner[]             @relation("PartnerReferrals")
  assignedAppointments  AppointmentRequest[]
  products            Product[]
  sessions            PartnerSession[]
  partnerCartItems    PartnerCartItem[]
  partnerOrders       PartnerOrder[]
  premiumRequests     PremiumPartnershipRequest[]
  withdrawalRequests  WithdrawalRequest[]
  reviews             VetReview[]
  createdAt           DateTime?              @default(now())
  updatedAt           DateTime?              @updatedAt

  @@index([referredById])
}

model PartnerSession {
  id        String   @id @default(cuid())
  token     String   @unique
  partnerId Int
  partner   Partner  @relation(fields: [partnerId], references: [id], onDelete: Cascade)
  expiresAt DateTime
  createdAt DateTime @default(now())

  @@index([partnerId])
}

model CompanySession {
  id        String   @id @default(cuid())
  token     String   @unique
  companyId Int
  company   Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  expiresAt DateTime
  createdAt DateTime @default(now())

  @@index([companyId])
}

model PartnerAvailableDay {
  id        Int     @id @default(autoincrement())
  day       DayOfWeek
  partner   Partner @relation(fields: [partnerId], references: [id], onDelete: Cascade)
  partnerId Int
  @@unique([day, partnerId])
  @@index([partnerId])
}

model PremiumPartnershipRequest {
  id                String   @id @default(cuid())
  partnerId         Int
  partner           Partner  @relation(fields: [partnerId], references: [id], onDelete: Cascade)
  paymentMethod     String
  paymentScreenshot String   // Cloudinary URL
  status            String   @default("pending") // pending, approved, rejected
  notes             String?  @db.Text
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  @@index([partnerId])
  @@index([status])
}

model WithdrawalRequest {
  id            String   @id @default(cuid())
  partnerId     Int
  partner       Partner  @relation(fields: [partnerId], references: [id], onDelete: Cascade)
  amount        Float
  accountTitle  String
  accountNumber String
  bankName      String   // JazzCash, EasyPaisa, Bank Name
  paymentMethod String   // jazzcash, easypaisa, bank_transfer
  status        String   @default("pending") // pending, approved, rejected
  notes         String?  @db.Text
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@index([partnerId])
  @@index([status])
}

model User {
  id            String              @id @default(cuid())
  name          String?
  email         String?              @unique
  emailVerified DateTime?
  image         String?
  PhoneNumber   String?
  country       String?
  password      String?
  accounts      Account[]
  sessions      Session[]
  cart          CartItem[]
  checkouts     Checkout[]
  appointments  AppointmentRequest[]
  sellAnimals   SellAnimal[]
  animalCart    AnimalCart[]
  jobApplicants JobApplicant[]
  testimonials  Testimonial[]
  wishlist      WishlistItem[]
  reviews       ProductReview[]
  vetReviews    VetReview[]
  createdAt DateTime? @default(now())

}

model Account {
  id                String  @id @default(cuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String? @db.Text
  access_token      String? @db.Text
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String? @db.Text
  session_state     String?
  user              User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  @@unique([provider, providerAccountId])
  @@index([userId])
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  createdAt    DateTime @default(now())
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime
  @@unique([identifier, token])
}

model CartItem {
  id        Int            @id @default(autoincrement())
  user      User           @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId    String
  product   Product        @relation(fields: [productId], references: [id], onDelete: Cascade)
  productId Int
  variantId Int
  quantity  Int            @default(1)
  createdAt DateTime       @default(now())
  variant   ProductVariant @relation(fields: [variantId], references: [id], onDelete: Cascade)
  @@unique([userId, productId, variantId])
  @@index([productId])
  @@index([variantId])
}

model WishlistItem {
  id        Int      @id @default(autoincrement())
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId    String
  product   Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  productId Int
  createdAt DateTime @default(now())

  @@unique([userId, productId])
  @@index([userId])
  @@index([productId])
}

model ProductReview {
  id         Int      @id @default(autoincrement())
  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId     String
  product    Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  productId  Int
  rating     Int      // 1-5 star rating
  comment    String   @db.Text
  isApproved Boolean  @default(true)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@unique([userId, productId])
  @@index([userId])
  @@index([productId])
  @@index([isApproved])
}

model VetReview {
  id         Int      @id @default(autoincrement())
  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId     String
  partner    Partner  @relation(fields: [partnerId], references: [id], onDelete: Cascade)
  partnerId  Int
  rating     Int      // 1-5 star rating
  comment    String   @db.Text
  isApproved Boolean  @default(true)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@unique([userId, partnerId])
  @@index([userId])
  @@index([partnerId])
  @@index([isApproved])
}

model Checkout {
  id               Int             @id @default(autoincrement())
  user             User            @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId           String
  city             String
  province         String
  shipmentcharges  String?         @db.Text
  address          String          @db.Text
  shippingAddress  String          @db.Text
  paymentMethod    String          @db.Text
  total            Float
  status           String
  createdAt        DateTime        @default(now())
  items            CheckoutItem[]  @relation("CheckoutToItems")

  @@index([userId])
}

model CheckoutItem {
  id                 Int             @id @default(autoincrement())
  checkout           Checkout        @relation(name: "CheckoutToItems", fields: [checkoutId], references: [id], onDelete: Cascade)
  checkoutId         Int
  product            Product?        @relation(fields: [productId], references: [id], onDelete: Cascade)
  productId          Int?
  variantId          Int?
  variant            ProductVariant? @relation(fields: [variantId], references: [id], onDelete: Cascade)
  animalId           Int?
  animal             SellAnimal?     @relation(fields: [animalId], references: [id], onDelete: Cascade)
  quantity           Int
  price              Float           // Final price after discount
  originalPrice      Float?          // Original price before discount
  discountPercentage Float?          // Discount percentage applied (e.g., 10 for 10%)
  purchasedPrice     Float?          // Price purchased from vendor/partner (editable)

  @@index([checkoutId])
  @@index([productId])
  @@index([variantId])
  @@index([animalId])
}


model AnimalNews {
  id          Int        @id @default(autoincrement())
  title       String     @unique
  description String     @db.Text
  name        String?
  whatsapp    String?
  email       String?
  image       newsImage? @relation(fields: [imageId], references: [id], onDelete: Cascade)
  imageId     Int?
  pdf         newsPdf?   @relation(fields: [pdfId], references: [id], onDelete: Cascade)
  pdfId       Int?
  isActive    Boolean    @default(false)
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt

  @@index([imageId])
  @@index([pdfId])
}

model newsImage {
  id        Int          @id @default(autoincrement())
  publicId  String
  url       String       @db.Text
  alt       String?
  newsPosts AnimalNews[]
}

model newsPdf {
  id        Int          @id @default(autoincrement())
  publicId  String
  url       String       @db.Text
  title     String?
  newsPosts AnimalNews[]
}

model SellAnimal {
  id              Int               @id @default(autoincrement())
  specie          String
  breed           String
  quantity        Int?
  ageType         AgeType
  ageNumber       Int
  location        String
  country         String?
  weightType      WeightType
  weightValue     Float
  gender          Gender
  healthCertificate Boolean
  totalPrice      Float
  purchasePrice   Float
  referredBy      String?           @db.Text
  status          SellStatus        @default(PENDING)
  autoDelete      Boolean           @default(true)
  userId          String
  user            User              @relation(fields: [userId], references: [id], onDelete: Cascade)
  images          SellAnimalImage[]
  videos          SellAnimalVideo[]
  animalCart      AnimalCart[]
  checkout        CheckoutItem[]
  createdAt       DateTime          @default(now())
  updatedAt       DateTime          @updatedAt

  @@index([userId])
}

model SellAnimalImage {
  id           Int        @id @default(autoincrement())
  url          String     @db.Text
  publicId     String
  alt          String
  sellAnimalId Int
  sellAnimal   SellAnimal @relation(fields: [sellAnimalId], references: [id], onDelete: Cascade)
  createdAt    DateTime   @default(now())

  @@index([sellAnimalId])
}

model SellAnimalVideo {
  id           Int        @id @default(autoincrement())
  url          String     @db.Text
  publicId     String
  alt          String
  sellAnimalId Int
  sellAnimal   SellAnimal @relation(fields: [sellAnimalId], references: [id], onDelete: Cascade)
  createdAt    DateTime   @default(now())

  @@index([sellAnimalId])
}

model AnimalCart {
  id        Int        @id @default(autoincrement())
  user      User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId    String
  animal    SellAnimal @relation(fields: [animalId], references: [id], onDelete: Cascade)
  animalId  Int
  quantity  Int        @default(1)

  @@index([userId])
  @@index([animalId])
}

model JobApplicant {
  id                Int             @id @default(autoincrement())
  name              String
  gender            Gender
  mobileNumber      String          @unique
  address           String          @db.Text
  qualification     String?         @db.Text
  dateOfBirth       DateTime?
  expectedPosition  String?         @db.Text
  expectedSalary    String?
  preferredIndustry String?         @db.Text
  preferredLocation String?         @db.Text
  highestDegree     String?         @db.Text
  degreeInstitution String?         @db.Text
  majorFieldOfStudy String?         @db.Text
  workExperience    String?         @db.Text
  previousCompany   String?         @db.Text
  declaration       DeclarationStatus
  imageId           Int?            @unique
  image             ApplicantImage? @relation(fields: [imageId], references: [id], onDelete: Cascade)
  cvId              Int?            @unique
  cv                ApplicantCV?    @relation(fields: [cvId], references: [id], onDelete: Cascade)
  userId            String
  user              User            @relation(fields: [userId], references: [id], onDelete: Cascade)
  createdAt         DateTime        @default(now())
  updatedAt         DateTime        @updatedAt

  @@index([imageId])
  @@index([cvId])
  @@index([userId])
}

model ApplicantImage {
  id        Int           @id @default(autoincrement())
  url       String        @db.Text
  publicId  String
  alt       String
  applicant JobApplicant?
}

model ApplicantCV {
  id        Int           @id @default(autoincrement())
  url       String        @db.Text
  publicId  String
  alt       String
  applicant JobApplicant?
}

model JobForm {
  id             Int          @id @default(autoincrement())
  name           String       @db.Text
  company        String       @db.Text
  mobileNumber   String
  email          String?
  position       String       @db.Text
  eligibility    String       @db.Text
  benefits       String       @db.Text
  location       String       @db.Text
  companyAddress String       @db.Text
  howToApply     String       @db.Text
 jobFormImage   JobFormImage? @relation(fields: [jobFormImageId], references: [id], onDelete: Cascade)
jobFormImageId Int?

  noofpositions  String       @db.Text
  deadline       String       @db.Text
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt

  @@index([jobFormImageId])
}

model JobFormImage {
  id        Int       @id @default(autoincrement())
  url       String    @db.Text
  alt       String
  publicId  String
  jobForms  JobForm[]
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
}

model monis {
  id       Int    @id @default(autoincrement())
  monisname String
}

model Banner {
  id        Int          @id @default(autoincrement())
  position  Int          @unique
  image     BannerImage?
  createdAt DateTime     @default(now())
  updatedAt DateTime     @updatedAt
}

model BannerImage {
  id        Int      @id @default(autoincrement())
  url       String   @db.Text
  alt       String   @unique
  publicId  String?  @unique
  banner    Banner   @relation(fields: [bannerId], references: [id], onDelete: Cascade)
  bannerId  Int      @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([bannerId])
}

model Testimonial {
  id         Int      @id @default(autoincrement())
  content    String   @db.Text
  isApproved Boolean  @default(false)
  isActive   Boolean  @default(true)
  userId     String
  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@index([userId])
}

model TraditionalJobPost {
  id          Int                     @id @default(autoincrement())
  title       String                  @db.Text
  description String                  @db.Text
  name        String?
  whatsapp    String?
  email       String?
  image       TraditionalJobPostImage?
  createdAt   DateTime                @default(now())
  updatedAt   DateTime                @updatedAt
}

model TraditionalJobPostImage {
  id        Int                  @id @default(autoincrement())
  url       String               @db.Text
  alt       String
  publicId  String?              @unique
  jobPost   TraditionalJobPost   @relation(fields: [jobPostId], references: [id], onDelete: Cascade)
  jobPostId Int                  @unique
  createdAt DateTime             @default(now())
  updatedAt DateTime             @updatedAt

  @@index([jobPostId])
}

enum AppointmentStatus {
  PENDING
  APPROVED
  REJECTED
}

enum SellStatus {
  PENDING
  ACCEPTED
  REJECTED
}

enum AgeType {
  DAYS
  WEEKS
  MONTHS
  YEARS
}

enum WeightType {
  TONS
  MUNS
  KGS
  GRAMS
}

enum DeclarationStatus {
  AGREED
  NOT_AGREED
}


model PaymentInfo {
  id                Int      @id @default(autoincrement())
  appointmentId     Int      @unique
  appointment       AppointmentRequest @relation(fields: [appointmentId], references: [id])

  consultationType  String   // "needy", "virtual", "physical"
  consultationFee   Float    // 0, 500, 1000
  paymentMethod     String?  // "jazzcash", "easypaisa", "bank", "cod" - null for needy

  // Payment screenshot (optional - not needed for COD)
  screenshotUrl     String?  @db.Text
  screenshotPublicId String? @db.Text

  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  @@index([appointmentId])
}




model AppointmentRequest {
  id            Int               @id @default(autoincrement())
  customerId    String
  customer      User              @relation(fields: [customerId], references: [id], onDelete: Cascade)
  doctor        String
  city          String
  state         String?
  country       String?
  species       String
  fullAddress   String?           @db.Text
  gender        Gender
  appointmentAt DateTime
  isEmergency   Boolean
  description   String            @db.Text
  paymentInfo      PaymentInfo?
   historyForm          HistoryForm?
   assignedDoctorId    Int?
  assignedDoctor      Partner?  @relation(fields: [assignedDoctorId], references: [id])
  assignedAt          DateTime?

  createdAt     DateTime          @default(now())
  status        AppointmentStatus @default(PENDING)

  @@index([customerId])
  @@index([assignedDoctorId])
}



model HistoryForm {
  id                    Int                @id @default(autoincrement())

  // Owner/Contact Information
  name                  String             @db.Text
  contact               String             @db.Text
  address               String             @db.Text


appointmentId        Int?                 @unique
  appointment          AppointmentRequest?  @relation(fields: [appointmentId], references: [id], onDelete: Cascade)


  // Animal Information
  animalSpecie          String             @db.Text
  breed                 String             @db.Text
  age                   String             @db.Text
  sex                   String             @db.Text
  tag                   String?            @db.Text
  use                   String?            @db.Text

  // Medical History
  mainIssue             String             @db.Text
  duration              String             @db.Text
  pastIllness           String?            @db.Text
  pastTreatment         String?            @db.Text
  allergies             String?            @db.Text
  surgeries             String?            @db.Text

  // Reproductive Information
  reproductiveStatus    String?            @db.Text
  lastEvent             String?            @db.Text

  // Management Information
  diet                  String?            @db.Text
  water                 String?            @db.Text
  housing               String?            @db.Text

  // Production Data
  milkPerDay            String?            @db.Text
  eggPerDay             String?            @db.Text
  weightGain            String?            @db.Text

  // Vaccination/Deworming
  vaccinationDeworming  Boolean?           @default(false)
  lastGiven             String?            @db.Text
  nextDue               String?            @db.Text

  // Exposure History
  newAnimalContact      Boolean?           @default(false)
  transport             Boolean?           @default(false)
  outbreakNearby        Boolean?           @default(false)
  wildlife              Boolean?           @default(false)
  parasites             Boolean?           @default(false)

  // Examination Details
  examinedBy            String?            @db.Text
  examinationDate       DateTime?
  referalNo             String?            @db.Text

  // Relation
  prescriptionForm      PrescriptionForm?

  // Timestamps
  createdAt             DateTime           @default(now())
  updatedAt             DateTime           @updatedAt

  @@index([appointmentId])
}

model PrescriptionForm {
  id                    Int                @id @default(autoincrement())
  prescriptionNo        String?


  // Doctor/Vet Information
  doctorName            String             @db.Text
  qualification         String?            @db.Text
  clinicName            String?            @db.Text
  clinicAddress         String?            @db.Text
  clinicPhone           String?            @db.Text
  clinicEmail           String?            @db.Text

  // Owner Information
  ownerName             String             @db.Text
  ownerContact          String             @db.Text

  // Animal Information
  animalSpecies         String             @db.Text
  breed                 String?            @db.Text
  age                   String?            @db.Text
  sex                   String?            @db.Text

  // Clinical Information
  clinicalDiagnosis     String?            @db.Text
  labDiagnosis          String?            @db.Text

  // Instructions
  continuePrevMedicine  Boolean            @default(false)
  followUpDate          DateTime?
  monitorSideEffects    Boolean            @default(false)
  maintainHygiene       Boolean            @default(false)

  // Prescription Items
  prescriptionItems     PrescriptionItem[]

  // Additional consultation fees
  additionalFees        AdditionalConsultationFee[]

  // Relation
  historyForm           HistoryForm        @relation(fields: [historyFormId], references: [id], onDelete: Cascade)
  historyFormId         Int                @unique

  // Timestamps
  createdAt             DateTime           @default(now())
  updatedAt             DateTime           @updatedAt

  @@index([historyFormId])
}

model PrescriptionItem {
  id                    Int                @id @default(autoincrement())

  // Medicine Details
  medicineName          String             @db.Text
  strength              String?            @db.Text
  dosage                String             @db.Text
  duration              String             @db.Text
  notes                 String?            @db.Text

  // Relations
  prescription          PrescriptionForm   @relation(fields: [prescriptionId], references: [id], onDelete: Cascade)
  prescriptionId        Int

  createdAt             DateTime           @default(now())
  updatedAt             DateTime           @updatedAt

  @@index([prescriptionId])
}
model Admin {
  id        String   @id @default(cuid())
  username  String   @unique
  password  String   // This will be hashed
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  sessions AdminSession[]
}
model AdminSession {
  id        String   @id @default(cuid())
  token     String   @unique  // This works perfectly!
  adminId   String
  admin     Admin    @relation(fields: [adminId], references: [id], onDelete: Cascade)
  expiresAt DateTime
  createdAt DateTime @default(now())

  @@index([adminId])
}

enum AdditionalFeeStatus {
  PENDING
  PAID
  CANCELLED
}

model AdditionalConsultationFee {
  id                Int                   @id @default(autoincrement())

  // Link to prescription
  prescriptionId    Int
  prescription      PrescriptionForm      @relation(fields: [prescriptionId], references: [id], onDelete: Cascade)

  // Fee details
  consultationFee   Float
  feeDescription    String                @db.Text

  // Payment information
  paymentMethod     String                // "jazzcash", "easypaisa", "bank", "cod"
  screenshotUrl     String?               @db.Text
  screenshotPublicId String?              @db.Text

  // Status
  status            AdditionalFeeStatus   @default(PENDING)

  // Timestamps
  createdAt         DateTime              @default(now())
  updatedAt         DateTime              @updatedAt

  @@index([prescriptionId])
}

// ============================================
// CENTRALIZED FINANCIAL MANAGEMENT SYSTEM (CNS)
// ============================================

model BusinessPartner {
  id              Int       @id @default(autoincrement())
  name            String
  email           String?
  phone           String?
  partnerType     String    // WEBSITE_OWNER, INVESTOR, VET_PARTNER, SUPPLIER, EMPLOYEE, OTHER
  sharePercentage Float     // e.g., 30.5 for 30.5%
  bankDetails     String?   @db.Text
  isActive        Boolean   @default(true)
  joinedDate      DateTime  @default(now())
  notes           String?   @db.Text

  distributions   PartnerDistribution[]
  expenses        Expense[]

  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
}

model Transaction {
  id              Int       @id @default(autoincrement())
  type            String    // PRODUCT_SALE, ANIMAL_SALE, CONSULTATION_FEE, ADDITIONAL_CONSULTATION, OTHER_INCOME
  amount          Float     // Revenue/Selling Price
  costPrice       Float?    // Purchase/Cost Price (for products and animals)
  profit          Float?    // Calculated profit (amount - costPrice)
  description     String    @db.Text
  transactionDate DateTime
  paymentMethod   String?
  status          String    @default("COMPLETED") // PENDING, COMPLETED, CANCELLED
  isAutoGenerated Boolean   @default(false) // Track if transaction was auto-created

  // References to existing models
  checkoutId      Int?      // Link to Checkout (orders)
  checkoutItemId  Int?      // Link to specific CheckoutItem for profit tracking
  appointmentId   Int?      // Link to AppointmentRequest
  additionalFeeId Int?      // Link to AdditionalConsultationFee

  notes           String?   @db.Text
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
}

model Expense {
  id              Int       @id @default(autoincrement())
  category        String    // PARTNER_DISTRIBUTION, PURCHASE_COST, OPERATING_EXPENSE, MARKETING, DELIVERY_COSTS, VET_FEES, OTHER
  amount          Float
  description     String    @db.Text
  expenseDate     DateTime
  paymentMethod   String?
  status          String    @default("PENDING") // PENDING, COMPLETED, CANCELLED

  paidToPartner   BusinessPartner? @relation(fields: [partnerId], references: [id])
  partnerId       Int?

  receiptUrl      String?   @db.Text
  receiptPublicId String?

  notes           String?   @db.Text
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  @@index([partnerId])
}

model PartnerDistribution {
  id              Int       @id @default(autoincrement())
  partner         BusinessPartner @relation(fields: [partnerId], references: [id], onDelete: Cascade)
  partnerId       Int

  periodStart     DateTime
  periodEnd       DateTime
  totalRevenue    Float     // Total revenue for this period
  shareAmount     Float     // Partner's calculated share
  status          String    @default("PENDING") // PENDING, COMPLETED, CANCELLED

  paymentDate     DateTime?
  paymentMethod   String?
  notes           String?   @db.Text

  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  @@index([partnerId])
}

model MasterTrainerRegistration {
  id              Int      @id @default(autoincrement())
  name            String   @db.Text
  email           String
  whatsappNumber  String
  address         String   @db.Text
  paymentConfirmed Boolean @default(false)
  approved        Boolean  @default(false)
  screenshotUrl   String?  @db.Text
  screenshotPublicId String?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}

// Dynamic Form System
model DynamicForm {
  id                  String             @id @default(cuid())
  title               String             // Form title
  description         String?            @db.Text // Form description
  slug                String             @unique // URL-friendly identifier
  thumbnailUrl        String?            @db.Text // Thumbnail image URL for listing
  thumbnailPublicId   String?            // Cloudinary public ID for thumbnail
  headerTitle         String?            @db.Text // Optional custom header (can be in multiple languages)
  headerSubtitle      String?            @db.Text // Optional custom subtitle
  paymentRequired     Boolean            @default(false) // Does this form require payment?
  paymentAmount       Float?             // Payment amount if required
  paymentAccount      String?            @db.Text // Payment account details
  thankYouMessage     String?            @db.Text // Custom thank you message
  thankYouButtonText  String?            // Custom button text (e.g., "Download Certificate")
  thankYouButtonUrl   String?            @db.Text // Custom button URL
  thankYouLinks       String?            @db.Text // JSON string for additional links
  isActive            Boolean            @default(true) // Is form accepting submissions?
  fields              FormField[]        // Form fields
  submissions         FormSubmission[]   // Form submissions
  createdAt           DateTime           @default(now())
  updatedAt           DateTime           @updatedAt

  @@index([slug])
  @@index([isActive])
}

model FormField {
  id                  String                    @id @default(cuid())
  form                DynamicForm               @relation(fields: [formId], references: [id], onDelete: Cascade)
  formId              String
  label               String                    // Field label
  fieldType           String                    // text, email, tel, textarea, file, checkbox, select, radio
  placeholder         String?                   // Placeholder text
  helpText            String?                   @db.Text // Additional help text
  isRequired          Boolean                   @default(false) // Is field required?
  orderIndex          Int                       // Order of field in form (0-based)
  options             String?                   @db.Text // JSON string for select/radio options
  validation          String?                   @db.Text // JSON string for validation rules
  fileAcceptTypes     String?                   // Accepted file types (for file inputs)
  maxFileSize         Int?                      // Max file size in bytes
  submissionValues    FormSubmissionValue[]     // Values from submissions
  createdAt           DateTime                  @default(now())
  updatedAt           DateTime                  @updatedAt

  @@index([formId])
  @@index([orderIndex])
}

model FormSubmission {
  id                  String                    @id @default(cuid())
  form                DynamicForm               @relation(fields: [formId], references: [id], onDelete: Cascade)
  formId              String
  approved            Boolean                   @default(false) // Admin approval status
  paymentScreenshotUrl String?                  @db.Text // Payment screenshot if required
  paymentScreenshotPublicId String?             // Cloudinary public ID
  fieldValues         FormSubmissionValue[]     // Individual field values
  createdAt           DateTime                  @default(now())
  updatedAt           DateTime                  @updatedAt

  @@index([formId])
  @@index([approved])
  @@index([createdAt])
}

model FormSubmissionValue {
  id                  String             @id @default(cuid())
  submission          FormSubmission     @relation(fields: [submissionId], references: [id], onDelete: Cascade)
  submissionId        String
  field               FormField          @relation(fields: [fieldId], references: [id], onDelete: Cascade)
  fieldId             String
  value               String             @db.Text // Field value (stored as text, can be JSON for complex types)
  fileUrl             String?            @db.Text // For file uploads
  filePublicId        String?            // Cloudinary public ID for files
  createdAt           DateTime           @default(now())
  updatedAt           DateTime           @updatedAt

  @@index([submissionId])
  @@index([fieldId])
}

// Sticky Logo Configuration
model StickyLogo {
  id        Int      @id @default(autoincrement())
  companyId Int
  company   Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([companyId])
}

// Social Media Token Management
model SocialMediaToken {
  id            Int      @id @default(autoincrement())
  platform      String   @unique // facebook, instagram, twitter, linkedin, etc.
  accessToken   String   @db.Text // Encrypted access token
  refreshToken  String?  @db.Text // Encrypted refresh token (if applicable)
  tokenType     String   @default("Bearer")
  expiresAt     DateTime? // When the token expires
  lastRefreshed DateTime @default(now())

  // Platform-specific metadata
  pageId        String?  // For Facebook/Instagram Page ID
  accountId     String?  // For any account-specific identifier

  // Status tracking
  isActive      Boolean  @default(true)
  lastError     String?  @db.Text
  errorCount    Int      @default(0)

  // Auto-refresh settings
  autoRefresh   Boolean  @default(true)
  refreshBeforeDays Int   @default(5) // Refresh 5 days before expiration

  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@index([platform])
  @@index([expiresAt])
  @@index([isActive])
}

// Email Logging System
enum EmailType {
  INITIAL_NOTIFICATION
  ACCEPTANCE_CONFIRMATION
  CASE_TAKEN
  PATIENT_ASSIGNMENT
  MASTER_TRAINER_APPROVAL
  OTHER
}

enum EmailStatus {
  SENT
  FAILED
  PENDING
}

model EmailLog {
  id              Int          @id @default(autoincrement())

  // Recipient information
  recipientEmail  String
  recipientName   String?
  recipientType   String       // VET, PATIENT, ADMIN, MASTER_TRAINER, etc.

  // Email details
  subject         String       @db.Text
  emailType       EmailType
  status          EmailStatus  @default(PENDING)

  // Error tracking
  errorMessage    String?      @db.Text
  attemptCount    Int          @default(1)

  // Relations
  appointmentId   Int?         // Link to appointment if applicable
  partnerId       Int?         // Link to vet/partner if applicable

  // Additional metadata (JSON)
  metadata        String?      @db.Text // Store additional info as JSON

  // Timestamps
  sentAt          DateTime?    // When email was successfully sent
  createdAt       DateTime     @default(now())
  updatedAt       DateTime     @updatedAt

  @@index([appointmentId])
  @@index([partnerId])
  @@index([recipientEmail])
  @@index([emailType])
  @@index([status])
  @@index([createdAt])
}

// Discount Management System
model Discount {
  id              Int              @id @default(autoincrement())
  name            String           @db.Text
  description     String?          @db.Text
  percentage      Float            // e.g., 10.0 for 10% off
  startDate       DateTime
  endDate         DateTime
  isActive        Boolean          @default(true)

  // Scope - company-level, product-level, or variant-level
  companyId       Int?
  company         Company?         @relation(fields: [companyId], references: [id], onDelete: Cascade)
  productId       Int?
  product         Product?         @relation(fields: [productId], references: [id], onDelete: Cascade)
  variantId       Int?
  variant         ProductVariant?  @relation(fields: [variantId], references: [id], onDelete: Cascade)

  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt

  @@index([companyId])
  @@index([productId])
  @@index([variantId])
  @@index([startDate, endDate])
  @@index([isActive])
}

// ============================================
// PARTNER B2B E-COMMERCE SYSTEM
// ============================================

model PartnerCartItem {
  id        Int            @id @default(autoincrement())
  partner   Partner        @relation(fields: [partnerId], references: [id], onDelete: Cascade)
  partnerId Int
  product   Product        @relation(fields: [productId], references: [id], onDelete: Cascade)
  productId Int
  variantId Int
  variant   ProductVariant @relation(fields: [variantId], references: [id], onDelete: Cascade)
  quantity  Int            @default(1)
  createdAt DateTime       @default(now())

  @@unique([partnerId, productId, variantId])
  @@index([partnerId])
  @@index([productId])
  @@index([variantId])
}

model PartnerOrder {
  id                Int                @id @default(autoincrement())
  partner           Partner            @relation(fields: [partnerId], references: [id], onDelete: Cascade)
  partnerId         Int
  company           Company            @relation(fields: [companyId], references: [id], onDelete: Cascade)
  companyId         Int
  city              String
  province          String
  address           String             @db.Text
  shippingAddress   String             @db.Text
  paymentMethod     String             @db.Text
  paymentScreenshot String?            @db.Text
  total             Float
  status            String             @default("pending")
  items             PartnerOrderItem[] @relation("PartnerOrderToItems")
  createdAt         DateTime           @default(now())
  updatedAt         DateTime           @updatedAt

  @@index([partnerId])
  @@index([companyId])
  @@index([status])
}

model PartnerOrderItem {
  id                 Int             @id @default(autoincrement())
  order              PartnerOrder    @relation(name: "PartnerOrderToItems", fields: [orderId], references: [id], onDelete: Cascade)
  orderId            Int
  product            Product         @relation(fields: [productId], references: [id], onDelete: Cascade)
  productId          Int
  variantId          Int
  variant            ProductVariant  @relation(fields: [variantId], references: [id], onDelete: Cascade)
  quantity           Int
  price              Float
  originalPrice      Float?
  discountPercentage Float?

  @@index([orderId])
  @@index([productId])
  @@index([variantId])
}

model CompanyPaymentSettings {
  id              Int      @id @default(autoincrement())
  company         Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  companyId       Int      @unique
  bankName        String?  @db.Text
  accountTitle    String?  @db.Text
  accountNumber   String?  @db.Text
  jazzcashNumber  String?
  easypaisaNumber String?
  enableCOD       Boolean  @default(false)
  enableBank      Boolean  @default(false)
  enableJazzcash  Boolean  @default(false)
  enableEasypaisa Boolean  @default(false)
  minimumOrderAmount Float? @default(0)
  policyText      String?  @db.Text
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@index([companyId])
}
